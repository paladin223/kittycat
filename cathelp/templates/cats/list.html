{% extends "index.html" %}
{% load listed_cat %}
{% load static %}
{% block main %}
  <div class="grid-container-all">
    <div class="selector_wrapper">
      <div class="selector">
        <div class="category-selectors">–¶–≤–µ—Ç–∞</div>
          {% for color in colors %}
            {% if color.slug != color_selected%}
              <a href="{{ color.get_absolute_url }}">
            {% endif %}
              <div class="category {% if color.slug != color_selected %}hoverable{% endif %}">
                <div class="category-text">{{ color.name }}</div>
              </div>
            {% if color.slug != color_selected%}
              </a>
            {% endif %}
          {% endfor %}
        {% if color_selected != ""%}
          <a href="{% url "cats:list" %}">
        {% endif %}
          <div class="category {% if color.slug != color_selected %}hoverable{% endif %}">
            <div class="category-text">–°–±—Ä–æ—Å–∏—Ç—å</div>
          </div>
        {% if color_selected != ""%}
          </a>
        {% endif %}
      </div>
    </div>
    {% if cats %}
      <div class="grid-container">
        
        {% for cat in cats %}
          {% show_cat cat user %}
        {% endfor %}
    {% else %}
      <div class="no_cats">–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ –∫–æ—Ç–∞.</div>
    {% endif %}
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const likeButtons = document.querySelectorAll('.LikeCat');
      
      likeButtons.forEach(button => {
          button.addEventListener('click', function () {
              const catSlug = this.dataset.catSlug;
              
              // –ü–æ–ª—É—á–∏—Ç–µ CSRF-—Ç–æ–∫–µ–Ω –∏–∑ cookie
              const csrfToken = document.cookie.match(/csrftoken=([^ ;]+)/)[1];
  
              // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º POST-–∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å CSRF-—Ç–æ–∫–µ–Ω–æ–º
              fetch(`like_cat/${catSlug}`, {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json',
                      'X-CSRFToken': csrfToken,
                  },
                  body: JSON.stringify({}),
              })
              .then(response => response.json())
              .then(data => {
                console.log('JSON Response:', data);
                if (data.auth == "true"){
                  const buttonText = this.textContent.trim();
                  this.textContent = (buttonText === 'üíî') ? 'üòª' : 'üíî';
                }
                else{
                  window.location.href = "{% url "users:login" %}"
                }
              })
              .catch(error => console.error('Fetch error:', error));
            })
        });
      });
  </script>
{% endblock %}